<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh M·ª•c S√°ch - UniLib</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
        .sidebar { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); height: fit-content; }
        .cat-link { display: block; padding: 12px 15px; color: #64748b; text-decoration: none; border-radius: 8px; font-weight: 500; transition: 0.2s; margin-bottom: 5px; font-size: 0.95rem; }
        .cat-link:hover, .cat-link.active { background: #eef2ff; color: #4f46e5; }
        .book-card { background: white; border-radius: 16px; overflow: hidden; transition: 0.3s; border: 1px solid #e2e8f0; }
        .book-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .book-img { height: 200px; object-fit: contain; width: 100%; background: #f1f5f9; padding: 20px; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg bg-white shadow-sm sticky-top">
    <div class="container">
        <a class="navbar-brand fw-bold text-primary" href="index.html">UniLib.</a>
        <div class="d-flex gap-2">
            <a href="index.html" class="btn btn-outline-secondary btn-sm">V·ªÅ trang ch·ªß</a>
        </div>
    </div>
</nav>

<div class="container py-5">
    <div class="row">
        <div class="col-md-3 mb-4">
            <div class="sidebar">
                <h5 class="fw-bold mb-3 px-2 text-dark">üìö Th·ªÉ Lo·∫°i S√°ch</h5>
                <a href="#" class="cat-link active" onclick="filterBooks('ALL', this)">üîÑ T·∫•t c·∫£ s√°ch</a>
                <a href="#" class="cat-link" onclick="filterBooks('CNTT', this)">üíª C√¥ng ngh·ªá th√¥ng tin</a>
                <a href="#" class="cat-link" onclick="filterBooks('KINHTE', this)">üí∞ Kinh t·∫ø - Qu·∫£n tr·ªã</a>
                <a href="#" class="cat-link" onclick="filterBooks('NGOAINGU', this)">üåè Ngo·∫°i ng·ªØ</a>
                <a href="#" class="cat-link" onclick="filterBooks('KYNANG', this)">üå± K·ªπ nƒÉng s·ªëng</a>
                <a href="#" class="cat-link" onclick="filterBooks('VANHOC', this)">üìñ VƒÉn h·ªçc - Ti·ªÉu thuy·∫øt</a>
                <a href="#" class="cat-link" onclick="filterBooks('KHOAHOC', this)">üî¨ Khoa h·ªçc c∆° b·∫£n</a>
                <a href="#" class="cat-link" onclick="filterBooks('DIENTU', this)">‚ö° ƒêi·ªán - ƒêi·ªán t·ª≠</a>
            </div>
        </div>

        <div class="col-md-9">
            <div class="bg-white p-4 rounded-4 mb-4 shadow-sm border">
                <h3 class="fw-bold mb-1" id="cat-title">T·∫•t c·∫£ s√°ch</h3>
                <p class="text-muted m-0" id="cat-desc">Kh√°m ph√° to√†n b·ªô kho t√†ng tri th·ª©c c·ªßa th∆∞ vi·ªán UniLib.</p>
            </div>

            <div class="row row-cols-1 row-cols-md-3 g-4" id="book-list">
            </div>
        </div>
    </div>
</div>

<script>
    // B·∫£n ƒë·ªì th√¥ng tin danh m·ª•c (T√™n + M√¥ t·∫£)
    const categoryInfo = {
        'ALL': { title: 'T·∫•t c·∫£ s√°ch', desc: 'Kh√°m ph√° to√†n b·ªô kho t√†ng tri th·ª©c c·ªßa th∆∞ vi·ªán UniLib.' },
        'CNTT': { title: 'C√¥ng ngh·ªá th√¥ng tin', desc: 'S√°ch l·∫≠p tr√¨nh, thu·∫≠t to√°n, c∆° s·ªü d·ªØ li·ªáu v√† m·∫°ng m√°y t√≠nh.' },
        'KINHTE': { title: 'Kinh t·∫ø - Qu·∫£n tr·ªã', desc: 'Gi√°o tr√¨nh kinh t·∫ø vƒ© m√¥, marketing, qu·∫£n tr·ªã kinh doanh.' },
        'NGOAINGU': { title: 'Ngo·∫°i ng·ªØ', desc: 'S√°ch h·ªçc ti·∫øng Anh, Nh·∫≠t, H√†n, luy·ªán thi TOEIC/IELTS.' },
        'KYNANG': { title: 'K·ªπ nƒÉng s·ªëng', desc: 'S√°ch ph√°t tri·ªÉn b·∫£n th√¢n, t∆∞ duy, giao ti·∫øp.' },
        'VANHOC': { title: 'VƒÉn h·ªçc - Ti·ªÉu thuy·∫øt', desc: 'C√°c t√°c ph·∫©m vƒÉn h·ªçc kinh ƒëi·ªÉn v√† ti·ªÉu thuy·∫øt hi·ªán ƒë·∫°i.' },
        'KHOAHOC': { title: 'Khoa h·ªçc c∆° b·∫£n', desc: 'To√°n cao c·∫•p, V·∫≠t l√Ω ƒë·∫°i c∆∞∆°ng, H√≥a h·ªçc.' },
        'DIENTU': { title: 'ƒêi·ªán - ƒêi·ªán t·ª≠', desc: 'Gi√°o tr√¨nh m·∫°ch ƒëi·ªán, vi x·ª≠ l√Ω, t·ª± ƒë·ªông h√≥a.' }
    };

    async function filterBooks(category, element) {
        // 1. C·∫≠p nh·∫≠t giao di·ªán Sidebar (Active)
        document.querySelectorAll('.cat-link').forEach(el => el.classList.remove('active'));
        if(element) element.classList.add('active');

        // 2. C·∫≠p nh·∫≠t Ti√™u ƒë·ªÅ & M√¥ t·∫£ ·ªü tr√™n ƒë·∫ßu trang
        const info = categoryInfo[category] || categoryInfo['ALL'];
        document.getElementById('cat-title').innerText = info.title;
        document.getElementById('cat-desc').innerText = info.desc;

        // 3. G·ªçi API l·∫•y s√°ch
        const listDiv = document.getElementById('book-list');
        listDiv.innerHTML = `
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-2 text-muted">ƒêang t√¨m s√°ch...</p>
            </div>`;

        try {
            let url = '/api/books';
            if (category !== 'ALL') {
                url += `?category=${category}`;
            }

            const res = await fetch(url);
            const books = await res.json();

            listDiv.innerHTML = '';

            if(books.length === 0) {
                listDiv.innerHTML = `
                    <div class="col-12 text-center text-muted py-5">
                        <i class="fas fa-box-open fs-1 mb-3 opacity-25"></i>
                        <p>Ch∆∞a c√≥ cu·ªën s√°ch n√†o thu·ªôc th·ªÉ lo·∫°i <b>${info.title}</b>.</p>
                    </div>`;
                return;
            }

            books.forEach(book => {
                const cover = `https://ui-avatars.com/api/?name=${book.title}&background=random&size=200&font-size=0.33`;
                const html = `
                    <div class="col">
                        <div class="book-card h-100">
                            <a href="book-details.html?id=${book.id}">
                                <img src="${cover}" class="book-img">
                            </a>
                            <div class="p-3">
                                <h6 class="fw-bold mb-1 text-truncate" title="${book.title}">${book.title}</h6>
                                <p class="small text-muted mb-2">${book.author ? book.author.fullName : '---'}</p>
                                <a href="book-details.html?id=${book.id}" class="btn btn-sm btn-outline-primary w-100">Xem chi ti·∫øt</a>
                            </div>
                        </div>
                    </div>
                `;
                listDiv.innerHTML += html;
            });

        } catch (e) {
            console.error(e);
            listDiv.innerHTML = '<p class="text-danger text-center">L·ªói t·∫£i d·ªØ li·ªáu!</p>';
        }
    }

    // Load l·∫ßn ƒë·∫ßu
    filterBooks('ALL', document.querySelector('.cat-link'));
</script>

</body>
</html>